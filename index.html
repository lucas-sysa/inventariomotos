<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario VIN</title>

<style>
* { box-sizing: border-box; }

body {
  font-family: Arial, Helvetica, sans-serif;
  background: #0f172a;
  color: #ffffff;
  padding: 16px;
  margin: 0;
}

h2 {
  text-align: center;
  font-size: 22px;
  margin-bottom: 16px;
}

/* Input VIN */
#vin {
  width: 100%;
  padding: 18px;
  font-size: 24px;
  border-radius: 10px;
  border: none;
  outline: none;
  text-align: center;
  font-weight: bold;
  background: #e5e7eb;
  color: #000;
}

/* Resultado */
#res {
  margin-top: 20px;
  padding: 18px;
  font-size: 20px;
  text-align: center;
  border-radius: 10px;
  font-weight: bold;
  min-height: 60px; /* Para que no salte el diseño */
}

/* Estados */
.ok   { background: #16a34a; }
.warn { background: #f59e0b; color: #000; }
.err  { background: #dc2626; }

/* Flash visual */
.flash { animation: flash 0.12s; }

@keyframes flash {
  from { transform: scale(1.05); }
  to   { transform: scale(1); }
}

/* Indicador de carga sutil */
.loading { opacity: 0.6; }
</style>
</head>

<body>

<h2>ESCANEAR VIN</h2>

<input
  id="vin"
  autofocus
  placeholder="ESCANEAR VIN"
  autocomplete="off"
>

<div id="res"></div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbwaEEXiNCQ9Mo-lQoZlBvJ8iK5GiVROGN888xyoiBoGYsP802rOTr5rKzUmdUvYU-2dTA/exec";

const vinInput = document.getElementById("vin");
const res = document.getElementById("res");

// Asegurar que el input siempre tenga el foco
document.addEventListener("click", () => vinInput.focus());

vinInput.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    e.preventDefault();

    const vin = vinInput.value.trim();
    if (!vin) return;

    // --- ACCIÓN INMEDIATA ---
    vinInput.value = ""; // Limpiamos el campo al instante para el siguiente escaneo
    res.classList.add("loading"); // Efecto visual opcional de "procesando"
    
    // Enviamos los datos en segundo plano
    enviarDatos(vin);
  }
});

function enviarDatos(vin) {
  fetch(URL, {
    method: "POST",
    body: new URLSearchParams({ vin })
  })
  .then(r => r.json())
  .then(d => {
    res.classList.remove("loading");
    
    if (d.error) {
      res.textContent = d.error;
      res.className = "err flash";
    } else {
      res.textContent = vin + ": " + d.resultado; // Agregamos el VIN para saber cuál respondió
      res.className =
        d.resultado === "SAP y WMS" ? "ok flash" :
        d.resultado.includes("SOLO") ? "warn flash" :
        "err flash";
    }
  })
  .catch(() => {
    res.classList.remove("loading");
    res.textContent = "ERROR DE CONEXIÓN";
    res.className = "err";
  });
}
</script>

</body>
</html>
